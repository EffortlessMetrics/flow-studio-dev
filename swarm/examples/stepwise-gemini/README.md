# Stepwise Gemini Golden Example

This directory contains a golden run generated by the **Gemini stepwise orchestrator** backend.

## Run Details

- **Backend**: `gemini-step-orchestrator`
- **Flows Executed**: `signal`, `plan`
- **Initiator**: `demo-stepwise-tool`
- **Mode**: Stepwise execution (one LLM call per step)
- **Stub Mode**: Generated with `SWARM_GEMINI_STUB=1` (simulated responses)

## Directory Structure

```
stepwise-gemini/
  spec.json      # Run specification (flows, backend, params)
  meta.json      # Run metadata (status, timestamps, etc.)
  events.jsonl   # Step-by-step event log
```

## What to Look For

### events.jsonl

The events log contains the complete execution timeline:

1. **run_created** - Initial run creation with backend and flow configuration
2. **run_started** - Beginning of each flow execution
3. **step_start** / **step_end** pairs for each step:
   - Signal flow steps: normalize, frame, author_reqs, critique_reqs, author_bdd, scope
   - Plan flow steps: impact, options, adr, interface, observability, test_strategy, work, design_critique
4. **run_completed** - Final status with step counts

Each event includes:
- `run_id` - Unique run identifier
- `ts` - ISO timestamp
- `kind` - Event type
- `flow_key` - Which flow (signal/plan)
- `step_id` - Step within the flow
- `agent_key` - Which agent executed the step
- `payload` - Additional context (role description, status, duration, engine)

### Gemini Backend Characteristics

The Gemini stepwise backend (`GeminiStepOrchestrator`):

- Executes one Gemini CLI call per step
- Emits events to `events.jsonl` for observability
- In stub mode, simulates successful completion without actual LLM calls
- Does not write per-step transcripts to `llm/` directories (lightweight mode)

### Differences from Claude Backend

Compare this example with `stepwise-claude/` to see:

1. **Transcript files**: Claude backend writes `.jsonl` transcripts per step
2. **Receipt files**: Claude backend writes receipt JSON per step with token usage
3. **Event structure**: Same event schema, different `engine` field values

## Viewing in Flow Studio

To visualize this run in Flow Studio:

```bash
make flow-studio
```

Then open: `http://localhost:5000/?run=stepwise-gemini`

Flow Studio will parse `events.jsonl` and render:
- Flow progress timeline
- Step execution status
- Agent assignments per step

## Regenerating This Example

To regenerate this golden example:

```bash
SWARM_GEMINI_STUB=1 uv run swarm/tools/demo_stepwise_run.py \
  --backend gemini-step-orchestrator \
  --flows signal,plan
```

Then copy the output from `swarm/runs/<run_id>/` to this directory.

## Related Documentation

- [Stepwise Backends](../../docs/FLOW_STUDIO.md#stepwise-backends)
- [GeminiStepOrchestrator](../../runtime/orchestrator.py)
- [Event Schema](../../docs/transcript_receipt_schema.md)
